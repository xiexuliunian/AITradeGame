# A股改造完成说明

## 概述

本次改造成功将 AITradeGame 适配为支持中国A股市场，可以与原有的加密货币版本并存运行。

## 新增文件列表

### 核心功能模块

1. **market_data_ashare.py** - A股市场数据获取模块
   - 使用 baostock 库获取实时A股行情
   - 支持技术指标计算（均线、RSI、MACD等）
   - 包含模拟数据回退机制

2. **trading_engine_ashare.py** - A股交易引擎
   - 完整的A股交易规则（T+1、涨跌停、最小交易单位）
   - 真实的费用计算（佣金+印花税）
   - 无杠杆交易

3. **ai_trader_ashare.py** - A股AI交易员
   - 中文提示词优化
   - 理解A股市场特点
   - 支持多种AI模型

4. **app_ashare.py** - A股独立应用
   - 完整的Flask Web应用
   - 独立数据库（AITradeGame_AShare.db）
   - 5分钟交易循环

### 文档和示例

5. **README_ASHARE.md** - A股版本中文文档
   - 详细的功能说明
   - 使用指南
   - 配置说明

6. **example_ashare.py** - 示例脚本
   - 展示市场数据获取
   - 演示费用计算
   - 说明交易规则

### 配置更新

7. **requirements.txt** - 依赖更新
   - 新增 baostock

8. **README.md / README_ZH.md** - 主文档更新
   - 新增A股版本说明
   - 版本选择指南

## A股版本主要特性

### 1. 市场数据
- **数据源**: baostock（免费开源的证券数据平台）
- **默认股票池**: 6只优质蓝筹股
  - 600519 贵州茅台
  - 000858 五粮液
  - 601318 中国平安
  - 600036 招商银行
  - 000333 美的集团
  - 300750 宁德时代
- **技术指标**: MA5/MA10/MA20, RSI14, MACD

### 2. 交易规则
- **T+1制度**: 当日买入次日才能卖出
- **涨跌停**: 普通股±10%，ST股±5%
- **交易单位**: 买入必须100股整数倍
- **交易费用**:
  - 买入: 佣金 0.03%（最低5元）
  - 卖出: 佣金 0.03% + 印花税 0.1%

### 3. AI交易策略
- **中文提示词**: 针对A股市场优化
- **风险控制**: 单股仓位≤30%，保留现金≥20%
- **止损止盈**: 建议止损-5%，止盈+15%

## 使用方法

### 快速开始

```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 运行A股版本
python app_ashare.py

# 3. 访问Web界面
# 浏览器会自动打开 http://localhost:5000
```

### 配置步骤

1. **添加API提供方**
   - 点击"API提供方"按钮
   - 输入提供方信息（如DeepSeek API）
   - 保存配置

2. **添加交易模型**
   - 点击"添加模型"按钮
   - 选择提供方和模型
   - 设置初始资金（建议10万元起）

3. **开始交易**
   - 系统自动每5分钟执行一次交易
   - 查看实时持仓和收益
   - 查看AI决策过程

### 运行示例

```bash
# 查看演示和说明
python example_ashare.py
```

## 技术实现

### 数据库隔离
- 加密货币版本: `AITradeGame.db`
- A股版本: `AITradeGame_AShare.db`
- 两个版本数据完全独立

### 费用计算示例

**买入100股，价格¥1680**
```
交易额 = 100 × 1680 = ¥168,000
佣金 = max(168,000 × 0.0003, 5) = ¥50.40
总成本 = 168,000 + 50.40 = ¥168,050.40
```

**卖出100股，价格¥1848（盈利10%）**
```
卖出金额 = 100 × 1848 = ¥184,800
佣金 = max(184,800 × 0.0003, 5) = ¥55.44
印花税 = 184,800 × 0.001 = ¥184.80
总费用 = 55.44 + 184.80 = ¥240.24
毛利润 = (1848 - 1680) × 100 = ¥16,800
净利润 = 16,800 - 50.40 - 240.24 = ¥16,509.36
实际收益率 = 16,509.36 / 168,050.40 = 9.82%
```

## 代码质量

### 已通过的检查
- ✅ 代码审查（Code Review）
- ✅ 安全扫描（CodeQL）
- ✅ 导入语句规范
- ✅ URL验证安全性
- ✅ 功能测试

### 安全增强
- 使用 `urlparse` 进行URL验证
- 严格的主机名检查
- 防止URL子串注入攻击

## 与原版的区别

| 特性 | 加密货币版本 | A股版本 |
|------|------------|---------|
| 数据源 | Binance + CoinGecko | baostock |
| 交易标的 | BTC, ETH等加密货币 | A股股票 |
| 杠杆 | 支持1-20倍 | 不支持（符合实际） |
| 交易制度 | 无限制 | T+1 |
| 价格限制 | 无 | ±10% 或 ±5% |
| 费用 | 单一费率 | 佣金+印花税 |
| 交易单位 | 任意 | 100股整数倍 |
| 界面语言 | 英文为主 | 中文 |
| 数据库 | AITradeGame.db | AITradeGame_AShare.db |
| 启动命令 | python app.py | python app_ashare.py |

## 注意事项

1. **模拟交易**: 本系统仅用于学习和策略测试，不涉及真实资金
2. **数据来源**: 优先使用baostock实时数据，未安装时自动切换到模拟数据
3. **AI决策**: 仅供参考，不构成投资建议
4. **实盘风险**: 实际投资请谨慎决策，风险自负

## 推荐AI模型

| 提供商 | 模型 | 特点 | 适用场景 |
|--------|------|------|----------|
| DeepSeek | deepseek-chat | 性价比高，中文能力强 | 推荐首选 |
| OpenAI | gpt-4 | 强大但成本高 | 追求最佳效果 |
| OpenAI | gpt-3.5-turbo | 平衡性价比 | 日常测试 |

## 未来改进方向

1. **更多股票池**: 支持自定义股票列表
2. **实时行情**: 更频繁的数据更新
3. **回测功能**: 历史数据回测
4. **策略优化**: 更多交易策略选择
5. **风控增强**: 更完善的风险控制机制

## 技术支持

- 文档: README_ASHARE.md
- 示例: example_ashare.py
- 问题反馈: GitHub Issues

## 许可证

MIT License - 与原项目保持一致

---

**改造完成时间**: 2025年
**版本**: v1.0.0-ashare
**兼容性**: 与原版并存，互不影响
